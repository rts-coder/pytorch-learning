---


typora-copy-images-to: 笔记保存图片
typora-root-url: 笔记保存图片
---

# Pytorch数据集加载

学习的两个法宝：

dir():打开、看见内部包含的各种内容

help（）：详细说明

![image-20201030195502632](/image-20201030195502632.png)

### Dataset类

torch.utils.data.Dataset提供的类：Dataset，它是一个抽象类。通过继承和重写这个类就可以定义自己的数据类。需要重写的函数包括：

__ getitem __()   :如何获取每一条数据，以及返回相应的数据。

__ len __ () :   求数据集的长度。



下面是这个类的解释文档：

使用conda activate pytorch  进入pytorch环境，在环境中使用jupyter  notebook可以打开jupyter

![image-20201030215724851](/image-20201030215724851.png)

查看Dataset的解释

![image-20201030220821308](/image-20201030220821308.png)

使用help（）在jupyter中大段文字比较清楚些。

还可以使用后面加问号的形式出来更加详细的说明。

![image-20201030220931404](/image-20201030220931404.png)

下面通过一个示例来说明这个类。

我们希望将文件中的图片读取出来并且返回该图片的标签。

代码文件如下：

```python
from  torch.utils.data import Dataset
from PIL import Image
import os

class MyData(Dataset):      #继承dataset继承类，之后我们再重写其中的方法

    def __init__(self,root_dir,label_dir):
        #我们创建的时候定义了两个变量
        #不同函数中的变量不可以共同使用，这里self的作用相当于将这个变量定义为了全局变量
        self.root_dir = root_dir
        self.label_dir = label_dir
        self.path = os.path.join(self.root_dir,self.label_dir)      #对两个路径进行拼接，这样不会出错
        self.img_path = os.listdir(self.path)       #获取所有图片的地址


    def __getitem__(self, idx):
        img_name = self.img_path[idx]       #获取单独图片的名称
        img_item_path = os.path.join(self.root_dir,self.label_dir,img_name)         #获取每张图片的相对地址
        img = Image.open(img_item_path)         #打开图片
        label = self.label_dir              #获取图片的label
        return img,label


    def __len__(self):
        return len(self.img_path)       #返回总共图片的数量


root_dir = "dataset/val"
ants_label_dir = "ants"
bees_label_dir = "bees"
ants_dataset = MyData(root_dir,ants_label_dir)
bees_dataset = MyData(root_dir,bees_label_dir)

#可以将两个数据集拼接起来
train_dataset = ants_dataset + bees_dataset
```

使用控制台运行：

![image-20201031142943259](/image-20201031142943259.png)

![image-20201031142954774](/image-20201031142954774.png)





















将数据集复制到pycharm的脚本位置处，文件的调用。

在文件夹点击右键，选择show in explorer，会打开文件夹所在位置，

![image-20201030222610990](/image-20201030222610990.png)

将其他地方的数据集放置在这里

![image-20201030222731124](/image-20201030222731124.png)



我们选择文件的路径，copy  pyth  得到的结果是绝对路径，copy  relative  path是当前大文件夹下面的相对路径。

绝对路径

```
D:\Pycharm\learn_pytorch\dataset\val\ants\800pxMeat_eater_ant_qeen_excavating_hole.jpg
```

相对路径：

```
dataset/val/ants/800pxMeat_eater_ant_qeen_excavating_hole.jpg
```

![image-20201030222845683](/image-20201030222845683.png)

在win中图片地址的写入时，可以选择在地址前面加r，或者将地址中所有的单斜杠转为双斜杠。

在控制台可以看到img的各种属性，以及各种方法，可以很方便调用。

![image-20201030224152711](/image-20201030224152711.png)

img.show()  可以查看图片

![image-20201030224411248](/image-20201030224411248.png)









代码部分：

```python
from  torch.utils.data import Dataset
from PIL import Image
import os

class MyData(Dataset):      #继承dataset继承类，之后我们再重写其中的方法

    def __init__(self,root_dir,label_dir):
        #我们创建的时候定义了两个变量
        #不同函数中的变量不可以共同使用，这里self的作用相当于将这个变量定义为了全局变量
        self.root_dir = root_dir
        self.label_dir = label_dir
        self.path = os.path.join(self.root_dir,self.label_dir)      #对两个路径进行拼接，这样不会出错
        self.img_path = os.listdir(self.path)       #获取所有图片的地址


    def __getitem__(self, idx):
        img_name = self.img_path[idx]       #获取单独图片的名称
        img_item_path = os.path.join(self.root_dir,self.label_dir,img_name)         #获取每张图片的相对地址
        img = Image.open(img_item_path)         #打开图片
        label = self.label_dir              #获取图片的label
        return img,label


    def __len__(self):
        return len(self.img_path)       #返回总共图片的数量


root_dir = "dataset/val"
ants_label_dir = "ants"
bees_label_dir = "bees"
ants_dataset = MyData(root_dir,ants_label_dir)
bees_dataset = MyData(root_dir,bees_label_dir)

#可以将两个数据集拼接起来
train_dataset = ants_dataset + bees_dataset

```















